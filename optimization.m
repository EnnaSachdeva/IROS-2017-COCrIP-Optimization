function [ output,init_opt ] = optimization( data_for_optim,initialization_opt,lb,ub,mu )
 
l11=data_for_optim(1);
l12=data_for_optim(2);
l13=data_for_optim(3);
l21=data_for_optim(4);
l22=data_for_optim(5);
l23=data_for_optim(6);
l31=data_for_optim(7);
l32=data_for_optim(8);
l33=data_for_optim(9);
L1=data_for_optim(10);
L2=data_for_optim(11);
th11=data_for_optim(12);
th12=data_for_optim(13);
th13=data_for_optim(14);
th21=data_for_optim(15);
th22=data_for_optim(16);
th23=data_for_optim(17);
th31=data_for_optim(18);
th32=data_for_optim(19);
th33=data_for_optim(20);
th1=data_for_optim(21);
th2=data_for_optim(22);
w11=data_for_optim(23);
w12=data_for_optim(24);
w13=data_for_optim(25);
wl1=data_for_optim(26);
w21=data_for_optim(27);
w22=data_for_optim(28);
w23=data_for_optim(29);
wl2=data_for_optim(30);
w31=data_for_optim(31);
w32=data_for_optim(32);
w33=data_for_optim(33);
dm=data_for_optim(34);
 
%%%% Formulating Ax=b denotes the static equilibrium conditions in a paritcular configuration
%% matrix A
%%%%% F11                                       F12                          F13...                  
%%%%% F21                                       F22                          F23... 
%%%%% F31                                       F32                          F33...
%%%%% N11                                       N12                          N13...           
%%%%% N21                                       N22                          N23...
%%%%% N31                                       N32                          N33...
%%%%% tau11                                    tau12                        tau1...
%%%%% tau2                                     tau21                        tau22...
%%%%% tau3                                     tau4                         tau31                                  tau32...
 
Aeq=[cos(th11) ,                             cos(th11+th12) ,                 cos(th11+th12+th13),...
    -sin(th21-pi/2),                        -sin(th21+th22-pi/2) ,           -sin(th21+th22+th23-pi/2),... 
     cos(th31)  ,                            cos(th31+th32)   ,              cos(th31+th32+th33),... 
    -sin(th11),                             -sin(th11+th12)  ,               -sin(th11+th12+th13),...
     cos(th21-pi/2) ,                        cos(th21+th22-pi/2) ,            cos(th21+th22+th23-pi/2),...
    -sin(th31),                             -sin(th31+th32)    ,             -sin(th31+th32+th33),...
        0  ,                                     0  ,                                 0,...                
        0  ,                                     0  ,                                 0,...
        0  ,                                     0 ,                                  0,                                0;
    %%%%%%%%%%%%%% 
     
     sin(th11)                              sin(th11+th12)                 sin(th11+th12+th13),...
     cos(th21-pi/2)                         cos(th21+th22-pi/2)            cos(th21+th22+th23-pi/2),... 
     sin(th31)                              sin(th31+th32)                 sin(th31+th32+th33),... 
     cos(th11)                              cos(th11+th12)                 cos(th11+th12+th13),...
     sin(th21-pi/2)                         sin(th21+th22-pi/2)            sin(th21+th22+th23-pi/2),...
     cos(th31)                              cos(th31+th32)                 cos(th31+th32+th33),...
        0                                          0                                0,...
        0                                          0                                0,...
        0                                          0                                0                                   0;
    %%%%%%%%%%%%%%  
     dm/2                                          0                                0,...
       0                                           0                                0,...
       0                                           0                                0,... 
     l11/2                                         0                                0,...
       0                                           0                                0,...
       0                                           0                                0,...
      -1                                           0                                0,...
       0                                           0                                0,...
       0                                           0                                0                                    0;
    %%%%%%%%%%%%%%    
     -l12*sin(th12)                                 dm/2                            0,...
       0                                            0                               0,...
       0                                            0                               0,...
     l12*cos(th12)                                 l12/2                            0,...
       0                                            0                               0,...
       0                                            0                               0,...
       1                                           -1                               0,...
       0                                            0                               0,...
       0                                            0                               0                                   0;
    %%%%%%%%%%%%  
     -l13*sin(th12+th13)                         -l13*sin(th13)                     dm/2,...
       0                                            0                               0,...
       0                                            0                               0,... 
     l13*cos(th12+th13)                          l13*cos(th13)                     l13/2,... 
       0                                            0                               0,...
       0                                            0                               0,...
       0                                            1                              -1,...            
       0                                            0                               0,...
       0                                            0                               0                                   0;
    %%%%%%%%%%%%%%
     L1*sin(th11-th1)                       L1*sin(th11+th12-th1)            L1*sin(th11+th12+th13-th1),...
       0                                            0                               0,...
       0                                            0                               0,... 
     L1*cos(th11-th1)                       L1*cos(th11+th12-th1)            L1*cos(th11+th12+th13-th1),...
       0                                            0                               0,...
       0                                            0                               0,...
       0                                            0                               1,...
      -1                                            0                               0,...
       0                                            0                               0                                   0;
    %%%%%%%%%%%%%       
    -121*sin(th11-th21+pi)                  -121*sin(th11+th12-th21+pi)     -l21*sin(th11+th12+th13-th21+pi),...       
     -dm/2                                          0                               0,...
       0                                            0                               0,... 
    -121*cos(th11-th21+pi)                  -121*cos(th11+th12-th21+pi)     -l21*cos(th11+th12+th13-th21+pi),...
     -l21/2                                         0                               0,...
       0                                            0                               0,...
       0                                            0                               0,...
       1                                           -1                               0,...
       0                                            0                               0                                   0;
    %%%%%%%%%%%%%%       
    -122*sin(th11-th21-th22+pi)          -122*sin(th11+th12-th21-th22+pi)    -122*sin(th11+th12+th13-th21-th22+pi),...
    -122*cos(pi/2-th22)                          -dm/2                               0,...     
         0                                         0                                 0,... 
    -122*cos(th11-th21-th22+pi)          -122*cos(th11+th12-th21-th22+pi)    -122*cos(th11+th12+th13-th21-th22+pi),...
    -122*sin(pi/2-th22)                         -l22/2                              0,...    
         0                                         0                                0,...
         0                                         0                                0,...
         0                                         1                                -1,...                                                                
         0                                         0                                0                                   0;
      %%%%%%%%%%%% ABCD
    -123*sin(th11-th21-th22-th23)   -123*sin(th11+th12-th21-th22-th23)  -123*sin(th11+th12+th13-th21-th22-th23),... 
    -123*cos(pi/2-th22-th23)           -123*cos(pi/2-th23)                         -dm/2,...
         0                                         0                                0,... 
    -123*cos(th11-th21-th22-th23+pi)   -123*cos(th11+th12-th21-th22-th23+pi)   -123*cos(th11+th12+th13-th21-th22-th23+pi),...
    -123*sin(pi/2-th22-th23)           -123*sin(pi/2-th23)                        -l23/2,...
         0                                         0                                0,...
         0                                         0                                0,... 
         0                                         0                                1,...
        -1                                         0                                0                                   0;
     %%%%%%%%%%%%%
   -L2*sin(th11-th2+pi)                 -L2*sin(th11+th12-th2+pi)             -L2*sin(th11+th12+th13-th2+pi),...
   -L2*cos(pi/2+th21-th2)               -L2*cos(pi/2+th21+th22-th2)           -L2*cos(pi/2+th21+th22+th23-th2),...
        0                                          0                                0,... 
   -L2*cos(th11-th2+pi)                 -L2*cos(th11+th12-th2+pi)             -L2*cos(th11+th12+th13-th2+pi),...
   -L2*sin(pi/2+th21-th2)               -L2*sin(pi/2+th21+th22-th2)           -L2*sin(pi/2+th21+th22+th23-th2),...
        0                                          0                                0,...
        0                                          0                                0,...
        0                                          0                                0,...
        1                                         -1                                0                                    0;
     %%%%%%%%%%%%
   l31*sin(th11-th31)                   l31*sin(th11+th12-th31)                l31*sin(th11+th12+th13-th31),...
   l31*cos(th21-th31-pi/2)              l31*cos(th21+th22-th31-pi/2)           l31*cos(th21+th22+th23-th31-pi/2),...
       dm/2                                       0                                 0,... 
   l31*cos(th11-th31)                   l31*cos(th11+th12-th31)                l31*cos(th11+th12+th13-th31),...
   l31*sin(th21-th31-pi/2)              l31*sin(th21+th22-th31-pi/2)           l31*sin(th21+th22+th23-th31-pi/2),...
      l31/2                                       0                                 0,...
       0                                          0                                 0,...
       0                                          0                                 0,...
       0                                          1                                -1                                       0;
    %%%%%%%%%%%%%
   l32*sin(th11-th31-th32)              l32*sin(th11+th12-th31-th32)           l32*sin(th11+th12+th13-th31-th32),... 
   l32*cos(th21-th31-th32-pi/2)         l32*cos(th21+th22-th31-th32-pi/2)      l32*cos(th21+th22+th23-th31-th32-pi/2),...  
   l32*sin(-th32)                          dm/2                                      0,... 
   l32*cos(th11-th31-th32)              l32*cos(th11+th12-th31-th32)           l32*(th11+th12+th13-th31-th32),... 
   l32*sin(th21-th31-th32-pi/2)         l32*sin(th21+th22-th31-th32-pi/2)      l32*sin(th21+th22+th23-th31-th32-pi/2),... 
   l32*cos(-th32)                          l32/2                                     0,...
       0                                          0                                 0,...
       0                                          0                                 0,...
       0                                          0                                 1                                       -1;
    %%%%%%%%%%%
       0                                          0                                 0,...
       0                                          0                                 0,...
       0                                          0                                dm/2,...
       0                                          0                                 0,...
       0                                          0                                 0,...
       0                                          0                               -l33/2,...
       0                                          0                                 0,...
       0                                          0                                 0,...
       0                                          0                                 0                                       1];
   %%%%%%%%%%%%%%
        
        
   
beq = [0;(w11+w12+w13+w21+w22+w23+w31+w32+w33+wl1+wl2); 
          (w11/2)*l11*cos(th11); (w11+w12/2)*l12*cos(th11+th12); (w11+w12+w13/2)*l13*cos(th11+th12+th13);  
         (w11+w12+w13+wl1/2)*L1*cos(th1) ; 
        -(w11+w12+w13+wl1+w21/2)*l21*cos(pi-th21); -(w11+w12+w13+wl1+w21+w22/2)*l22*cos(pi-th21-th22);-(w11+w12+w13+wl1+w21+w22+w23/2)*l23*cos(pi-th21-th22-th23);
        -(w11+w12+w13+wl1+w21+w22+w23+wl2/2)*L2*cos(pi-th2);
         (w11+w12+w13+wl1+w21+w22+w23+wl2+w31/2)*l31*cos(th31); (w11+w12+w13+wl1+w21+w22+w23+wl2+w31+w32/2)*l32*cos(th31+th32);
         (w33/2)*l33*cos(th31+th32+th33)];
 
 
%%%%###########################################################################################################################
 
%%% Formulating Ax<=b denote the F<=mu*N 
%% matrix A
%%%%% F11 F12 F13 F21 F22 F23 F31 F32 F33 N11  N12  N13  N21  N22 N23  N31  N32  N33 tau11 tau12 tau1 tau2 tau21 tau22 tau3 tau4 tau31  tau32
A=[    1 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 0 ,-mu , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0  , 0 ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 1,  0 , 0 , 0 , 0 , 0 , 0 , 0 , 0  ,-mu , 0  , 0  , 0 ,  0 ,  0 , 0  , 0  , 0 ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  1 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  ,-mu , 0  , 0 ,  0 ,  0 , 0  , 0  , 0 ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 1 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  ,-mu , 0 ,  0 ,  0 , 0  , 0  , 0 ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 1 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  ,-mu,  0 ,  0 , 0  , 0  , 0 ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0; 
       0 , 0,  0 , 0 , 0 , 1 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 , -mu , 0 , 0  , 0  , 0 ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 1 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 , -mu, 0  , 0  , 0 ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 1 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , -mu, 0  , 0 ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 1 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  ,-mu , 0 ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0  , 1 ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   1 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   0 ,   1   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   0 ,   0   , 1   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   0 ,   0   , 0   ,1   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   0 ,   0   , 0   ,0   , 1  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   0 ,   0   , 0   ,0   , 0  ,  1   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   0 ,   0   , 0   ,0   , 0  ,  0   ,1 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  1   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  1;
       1 , 1,  1 , 0 , 0 , 0 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 1 , 1 , 1 , 0 , 0 , 0 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0;
       0 , 0,  0 , 0 , 0 , 0 , 1 , 1 , 1 , 0  , 0  , 0  , 0  , 0 ,  0 ,  0 , 0  , 0 , 0  ,   0 ,   0   , 0   ,0   , 0  ,  0   ,0 ,  0   ,  0];
       
    b=[0 ; 0 ; 0 ; 0 ; 0 ; 0 ; 0 ; 0 ; 0; 0.6 ;0.6 ; 0.6 ; 0.6; 0.6; 0.6; 0.6; 0.6; 0.6; 0.6; 4*0.2/dm ; 4*0.2/dm ; 4*0.2/dm];
    opts = optimset('Algorithm','interior-point');
% opts= optimoptions(@fmincon,'Algorithm','sqp','Display','iter-detailed');   %%% searches for global minima
% opts = optimset('Algorithm','sqp','MaxIter',5000,'MaxFunEvals',100000,'Display','iter');
 
 
    %%%%%% optimization technique
    ceq=[];
    c=[];
    
  
%% using cvx, but first run cv set up matlab file 
% n=size(Aeq,2);
% cvx_begin
%     variable x(n);
% %   minimize(norm(x(7),1)+norm(x(8),1)+norm(x(9),1)+norm(x(10),1));
%     maximize(-norm(x(10),2)-norm(x(11),2)-norm(x(12),2)+norm(x(13),2)+norm(x(14),2)+norm(x(15),2)+norm(x(16),2)+norm(x(17),2)+norm(x(18),2));
% %   minimize(-abs(x(7))-abs(x(8))-abs(x(9))-abs(x(10)));
%     subject to
%     Aeq*x == beq;
%     A*x < b;
% %     x(1)==x(3);
% %     x(4)==x(6);
% 
%     cvx_end
% % 
%     M=[Aeq;A];
%     n=[beq;b];
%     size(M)
%     size(n)
%     x0 = Aeq\beq
%     x0= lsqnonneg(Aeq,beq)
       
%   x=fsolve(@(x)double(Aeq)*x-double(beq),x0)
% %  
% A=[];
% b=[];
    x0= initialization_opt; 
%    f = zeros(size(x0));
%    xnew = linprog(f,A,b,Aeq,beq,lb,ub)
%    
    %%%% maximizing sum of normal forces
    x = fmincon(@(x)(-norm(x(10),2)-norm(x(11),2)-norm(x(12),2)-norm(x(13),2)-norm(x(14),2)-norm(x(15),2)-norm(x(16),2)-norm(x(17),2)-norm(x(18),2)) ,x0,A,b,Aeq,beq,lb,ub,[ceq,c],opts); %%%%% maximizing Normal forces
 
%      x = fmincon(@(x)(norm((x(1)/x(10)),2)+norm((x(2)/x(11)),2)+norm((x(3)/x(12)),2)+norm((x(4)/x(13)),2)+norm((x(5)/x(14)),2)+norm((x(6)/x(15)),2)+norm((x(7)/x(16)),2)+norm((x(8)/x(17)),2)+norm((x(9)/x(18)),2)) ,x0,A,b,Aeq,beq,lb,ub,[ceq,c],opts); %%%%% maximizing Normal forces
 
    %%% minimizing sum of moments forces
%     x = fmincon(@(x)(norm(x(19),2)+norm(x(20),2)+norm(x(21),2)+norm(x(22),2)+norm(x(23),2)+norm(x(24),2)+norm(x(25),2)+norm(x(26),2)+norm(x(27),2)+norm(x(28),2)) ,x0,A,b,Aeq,beq,lb,ub,[ceq,c],opts); 
%      x = fmincon(@(x)(norm(x(21),2)+norm(x(22),2)+norm(x(25),2)+norm(x(26),2)) ,x0,A,b,Aeq,beq,lb,ub,[ceq,c],opts); 
 
%   x = fmincon(@(x)(norm(x(19),2)+norm(x(20),2)+norm(x(21),2)+norm(x(22),2)+norm(x(23),2)+norm(x(24),2)+norm(x(25),2)+norm(x(26),2)+norm(x(27),2)+norm(x(28),2)) ,x0,A,b,Aeq,beq,lb,ub,[ceq,c],opts); %%%%% maximizing Normal forces
%   x = fmincon(@(x)(-norm(x(11),2)-norm(x(14),2)-norm(x(17),2)) ,x0,A,b,Aeq,beq,lb,ub,[ceq,c],opts); %%%%% maximizing middle point normal forces of all modules
 
% %   opts = optimoptions('fminunc','Display','none','Algorithm','quasi-newton');
%   x = fminunc(@(x)(-norm(x(10),2)-norm(x(11),2)-norm(x(12),2)-norm(x(13),2)-norm(x(14),2)-norm(x(15),2)-norm(x(16),2)-norm(x(17),2)-norm(x(18),2)),x0,opts);
%   
% x = fmincon(@(x)(Aeq*x-b),x0); %%%%% maximizing Normal forces
 
% x = fmincon(@(x)(norm(x(7),1)+norm(x(8),1)+norm(x(9),1)+norm(x(10),1)),x0,A,b,Aeq,beq,lb,ub,[ceq,c],opts)  %%%%% minimizing moments 
% x = fmincon(@(x)(-norm(x(1),2)-norm(x(2),2)-norm(x(3),2)) ,x0,A,b,Aeq,beq,lb,ub,[ceq,c],opts);  %%%%% maximizing traction forces;
% x = fmincon(@(x)(x(7)+x(8)+x(9)+x(10)) ,x0,A,b,Aeq,beq,lb,ub)
%%%%%%%%%%%%%% to check which constraint is not being satisfied
 
output=x;
init_opt=output;
end
